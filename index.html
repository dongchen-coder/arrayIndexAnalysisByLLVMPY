<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<style>
*{margin:0;padding:0;}
body {
	font:13.34px helvetica,arial,freesans,clean,sans-serif;
	color:black;
	line-height:1.4em;
	background-color: #F8F8F8;
	padding: 0.7em;
}
p {
	margin:1em 0;
	line-height:1.5em;
}
table {
	font-size:inherit;
	font:100%;
	margin:1em;
}
table th{border-bottom:1px solid #bbb;padding:.2em 1em;}
table td{border-bottom:1px solid #ddd;padding:.2em 1em;}
input[type=text],input[type=password],input[type=image],textarea{font:99% helvetica,arial,freesans,sans-serif;}
select,option{padding:0 .25em;}
optgroup{margin-top:.5em;}
pre,code{font:12px Monaco,"Courier New","DejaVu Sans Mono","Bitstream Vera Sans Mono",monospace;}
pre {
	margin:1em 0;
	font-size:12px;
	background-color:#eee;
	border:1px solid #ddd;
	padding:5px;
	line-height:1.5em;
	color:#444;
	overflow:auto;
	-webkit-box-shadow:rgba(0,0,0,0.07) 0 1px 2px inset;
	-webkit-border-radius:3px;
	-moz-border-radius:3px;border-radius:3px;
}
pre code {
	padding:0;
	font-size:12px;
	background-color:#eee;
	border:none;
}
code {
	font-size:12px;
	background-color:#f8f8ff;
	color:#444;
	padding:0 .2em;
	border:1px solid #dedede;
}
img{border:0;max-width:100%;}
abbr{border-bottom:none;}
a{color:#4183c4;text-decoration:none;}
a:hover{text-decoration:underline;}
a code,a:link code,a:visited code{color:#4183c4;}
h2,h3{margin:1em 0;}
h1,h2,h3,h4,h5,h6{border:0;}
h1{font-size:170%;border-top:4px solid #aaa;padding-top:.5em;margin-top:1.5em;}
h1:first-child{margin-top:0;padding-top:.25em;border-top:none;}
h2{font-size:150%;margin-top:1.5em;border-top:4px solid #e0e0e0;padding-top:.5em;}
h3{margin-top:1em;}
hr{border:1px solid #ddd;}
ul{margin:1em 0 1em 2em;}
ol{margin:1em 0 1em 2em;}
ul li,ol li{margin-top:.5em;margin-bottom:.5em;}
ul ul,ul ol,ol ol,ol ul{margin-top:0;margin-bottom:0;}
blockquote{margin:1em 0;border-left:5px solid #ddd;padding-left:.6em;color:#555;}
dt{font-weight:bold;margin-left:1em;}
dd{margin-left:2em;margin-bottom:1em;}
sup {
    font-size: 0.83em;
    vertical-align: super;
    line-height: 0;
}
* {
	-webkit-print-color-adjust: exact;
}
@media screen and (min-width: 914px) {
    body {
        width: 854px;
        margin:0 auto;
    }
}
@media print {
	table, pre {
		page-break-inside: avoid;
	}
	pre {
		word-wrap: break-word;
	}
}
</style>
<title>



Tutorial for Iterating Over a Python List
===============

Dong Chen

Introduction
------------

A Python list is an</title>

</head>
<body>
<h1>Tutorial for Iterating Over a Python List</h1>

<p>Dong Chen</p>

<h2>Introduction</h2>

<p>A Python list is an ordered sequence of items which don’t have to be of the same type. Numbers, letters, strings, nested lists can on the same list.</p>

<p><b>List creation:</b></p>

<p>The plain way to create a Python list is just by statically writing the items between square brackets.</p>

<pre><code>list ＝ ［ 1，‘a’， “hello”， sublist， Student(“Dong”) ］
</code></pre>

<p>List can also be created by list comprehensions. List comprehension is a description about what list should be created. It contains two parts: one is what
the items in the list will be like, the other is how to get them.</p>

<pre><code>list = [ x+y for x in ‘one’ for y in ’two’]
&gt;&gt;&gt; list
&gt;&gt;&gt; [‘ot’,’ow’,’oo’,’nt’,’nw’,’no’,’et’,’ew’,’eo’]
</code></pre>

<p><b>Iterating over a Python list:</b></p>

<pre><code>list = [1, 2, 3, 4]
for item in list:
    print (item)

&gt;&gt;&gt;1
2
3
4
</code></pre>

<h2>Code Sample</h2>

<p><b>Python Code:</b></p>

<pre><code>list = [1, 2, 3, 4]
for item in list:
    print (item)
</code></pre>

<p><b>Assemble Code:</b> <br/>
Then we can compile Python code by comand line:</p>

<pre><code>python -m dis filename.py
</code></pre>

<p>The resulting assemble code is listed below:</p>

<pre><code>1         0 LOAD_CONST               0 (1)
          3 LOAD_CONST               1 (2)
          6 LOAD_CONST               2 (3)
          9 LOAD_CONST               3 (4)
         12 BUILD_LIST               4
         15 STORE_NAME               0 (list)

2       18 SETUP_LOOP              19 (to 40)
         21 LOAD_NAME                0 (list)
         24 GET_ITER            
    &gt;&gt;   25 FOR_ITER                11 (to 39)
         28 STORE_NAME               1 (item)

3        31 LOAD_NAME                1 (item)
         34 PRINT_ITEM          
         35 PRINT_NEWLINE       
         36 JUMP_ABSOLUTE           25
    &gt;&gt;   39 POP_BLOCK           
    &gt;&gt;   40 LOAD_CONST               4 (None)
         43 RETURN_VALUE
</code></pre>

<h2>Execution </h2>

<p>The execution process of iterating the list can be visualized on <a http://pythontutor.com/">Python Tutorial</a>.</p>

<p><img src="./1.png" title="Optional title" alt="Alt text" />
<img src="./2.png" title="Optional title" alt="Alt text" /></p>

<p><b>SETUP_LOOP</b></p>

<p>SETUP_LOOP is to create a new block object on the top of the block stack which is maintained in the frame. The block object maintains the address of the first instruction should be executed when the block pop out. Here is INSTR_OFFSET()+oparg = 21+19 = 40. The block object also maintians the the block type which is acturally the operation to create new blocks: SETUP_LOOP, SETUP_EXCEPT, SETUP_FINALLY. Here is SETUP_LOOP.</p>

<p><b>GET_ITER</b></p>

<p>GET_ITER is to get the iterator object for whatever object on the top of the stack. Each Python object type has its own iterator object. PyObject_GetIter() is first to get the type object from the TOP object and then get its iterator object.</p>

<p>The core function of GET_ITER is</p>

<pre><code>PyObject * PyObject_GetIter(PyObject *o) {
    PyTypeObject *t = o-&gt;ob_type;
    f = t-&gt;tp_iter;
    PyObject *res = (*f)(o);   /* list_iter() */
    return res;
}
</code></pre>

<p><b>FOR_ITER</b></p>

<p>FOR_ITER will first call next() function of iterator, if returned object pointer is still a iterator object(not NULL), then push it to stack, CONTINUE to execute the next operation. if the returned pointer is NULL, it means the iterator has reached the end, and pop the iterator object out and jump by the offset of its argument to exit the iteration. HERE is 11.</p>

<pre><code>x = (*v-&gt;ob_type-&gt;tp_iternext)(v) /* listiter_next() */
</code></pre>
</body>
</html>